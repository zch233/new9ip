import{d as s,_ as e,x as t,a,u as n,r as o,c as r,e as i,a7 as l,p as u,f as d,h as c,i as p,j as m,k as b,t as v,n as f,F as y,q as h,m as P}from"./index.99b5cbf9.js";import{_ as I}from"./UIButton.42a08439.js";import{_ as g}from"./UIModal.c821572f.js";import{p as C}from"./patent.6d899c9d.js";var _=s({name:"PreorderButton",components:{UIButton:I,UIModal:g,Icon:e},props:{patent:{type:Object,default:()=>({})},big:Boolean,disabled:Boolean,size:String,buttonClass:String},setup(s){const e=t(),u=a(),d=n(),c=o(!1);return{userPoints:r((()=>e.getters.userPoints)),oneDayConsumePoints:r((()=>e.getters.oneDayConsumePoints)),preorderPatent:()=>{return t=this,a=null,n=function*(){yield C({days:1,productId:s.patent.id}).finally((()=>c.value=!1)),i.success("预留成功"),yield u.push("/user/preorder"),e.commit("COMMIT_consumePointsByPreorder")},new Promise(((s,e)=>{var o=s=>{try{i(n.next(s))}catch(t){e(t)}},r=s=>{try{i(n.throw(s))}catch(t){e(t)}},i=e=>e.done?s(e.value):Promise.resolve(e.value).then(o,r);i((n=n.apply(t,a)).next())}));var t,a,n},visible:c,showModal:()=>{if(!e.state.user.account)return i.error("您尚未登录"),void u.push({path:"/auth/sign_in",query:{redirect:d.fullPath}});e.state.oneDayConsumePoints>e.state.userPoints?l.confirm({title:"积分不足",content:"抱歉，您的剩余积分不足",okText:"立即充值",cancelText:"继续逛逛",onOk(){u.push("/vip")}}):c.value=!0}}}});const k=h("data-v-2df3d210");u("data-v-2df3d210");const w=P("预留"),x={class:"wrapper"},B=P("将消耗 "),M=P(" 个积分，是否继续？"),U=P("当前剩余："),j=P(" 积分");d();const D=k(((s,e,t,a,n,o)=>{const r=c("UIButton"),i=c("Icon"),l=c("UIModal");return p(),m(y,null,[b(r,{size:s.size,class:["preorderButton",[s.big&&"big",s.buttonClass]],disabled:s.disabled,"customer-class":"default",onClick:s.showModal},{default:k((()=>[w])),_:1},8,["size","class","disabled","onClick"]),b(l,{width:416,visible:s.visible,"onUpdate:visible":e[1]||(e[1]=e=>s.visible=e),maskClosable:!1,title:"预留专利",onOk:s.preorderPatent},{default:k((()=>[b("div",x,[b(i,{class:"warning",icon:"warning"}),b("div",null,[b("p",null,[b("b",null,"预留专利："+v(s.patent.name),1)]),f("        预留天数："),f("        <InputNumber autoFocus min={1} max={3} value={days} onChange={(day) => setDays(parseInt((day || 1).toString()))} /> 天"),b("p",null,[B,b("b",null,v(s.oneDayConsumePoints),1),M]),b("span",null,[U,b("b",null,v(s.userPoints),1),j])])])])),_:1},8,["visible","onOk"])],64)}));_.render=D,_.__scopeId="data-v-2df3d210";export{_};
