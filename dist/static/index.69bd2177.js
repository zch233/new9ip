import{d as e,_ as s,x as t,a,u as n,r as o,c as r,e as i,a7 as l,p as u,f as d,h as c,i as p,j as b,k as m,t as v,F as f,n as P,q as h}from"./index.f1efcfa5.js";import{_ as y}from"./UIButton.ea291404.js";import{_ as I}from"./UIModal.254e3879.js";import{p as g}from"./patent.a175c129.js";var C=e({name:"PreorderButton",components:{UIButton:y,UIModal:I,Icon:s},props:{patent:{type:Object,default:()=>({})},big:Boolean,disabled:Boolean,size:String,buttonClass:String},setup(e){const s=t(),u=a(),d=n(),c=o(!1);return{userPoints:r((()=>s.getters.userPoints)),oneDayConsumePoints:r((()=>s.getters.oneDayConsumePoints)),preorderPatent:()=>{return t=this,a=null,n=function*(){yield g({days:1,productId:e.patent.id}).finally((()=>c.value=!1)),i.success("预留成功"),yield u.push("/user/preorder"),s.commit("COMMIT_consumePointsByPreorder")},new Promise(((e,s)=>{var o=e=>{try{i(n.next(e))}catch(t){s(t)}},r=e=>{try{i(n.throw(e))}catch(t){s(t)}},i=s=>s.done?e(s.value):Promise.resolve(s.value).then(o,r);i((n=n.apply(t,a)).next())}));var t,a,n},visible:c,showModal:()=>{if(!s.state.user.account)return i.error("您尚未登录"),void u.push({path:"/auth/sign_in",query:{redirect:d.fullPath}});s.state.oneDayConsumePoints>s.state.userPoints?l.confirm({title:"积分不足",content:"抱歉，您的剩余积分不足",okText:"立即充值",cancelText:"继续逛逛",onOk(){u.push("/vip")}}):c.value=!0}}}});const _=P("data-v-7feb0d25");u("data-v-7feb0d25");const k=h("预留"),w={class:"wrapper"},B=h("将消耗 "),x=h(" 个积分，是否继续？"),M=h("当前剩余："),U=h(" 积分");d();const j=_(((e,s,t,a,n,o)=>{const r=c("UIButton"),i=c("Icon"),l=c("UIModal");return p(),b(f,null,[m(r,{size:e.size,class:["preorderButton",[e.big&&"big",e.buttonClass]],disabled:e.disabled,"customer-class":"default",onClick:e.showModal},{default:_((()=>[k])),_:1},8,["size","class","disabled","onClick"]),m(l,{width:416,visible:e.visible,"onUpdate:visible":s[1]||(s[1]=s=>e.visible=s),maskClosable:!1,title:"预留专利",onOk:e.preorderPatent},{default:_((()=>[m("div",w,[m(i,{class:"warning",icon:"warning"}),m("div",null,[m("p",null,[m("b",null,"预留专利："+v(e.patent.name),1)]),m("p",null,[B,m("b",null,v(e.oneDayConsumePoints),1),x]),m("span",null,[M,m("b",null,v(e.userPoints),1),U])])])])),_:1},8,["visible","onOk"])],64)}));C.render=j,C.__scopeId="data-v-7feb0d25";export{C as _};
