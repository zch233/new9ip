var e=Object.assign,t=(e,t,a)=>new Promise(((o,n)=>{var i=e=>{try{r(a.next(e))}catch(t){n(t)}},s=e=>{try{r(a.throw(e))}catch(t){n(t)}},r=e=>e.done?o(e.value):Promise.resolve(e.value).then(i,s);r((a=a.apply(e,t)).next())}));import{a,_ as o}from"./UITabPane.7bfa9618.js";import{d as n,_ as i,u as s,q as r,r as l,ad as c,aM as u,y as p,bc as d,al as m,A as y,be as g,ak as v,D as f,F as h,G as T,H as b,J as k,b as S,K as O,L as I,O as C,Q as U,M as _,N as P}from"./index.cd225e74.js";import{_ as w}from"./UIButton.1176b708.js";import{_ as j,a as R}from"./index.04e8ff89.js";import{_ as z}from"./UIEmpty.2c1e0a3a.js";import{_ as N}from"./UIPagination.94fb46e8.js";import{_ as D}from"./UISpin.8bc43c65.js";import{_ as A}from"./UICountdown.3b2f055a.js";import{_ as E}from"./index.6cdccd12.js";import{_ as q}from"./UITooltip.e8ca16c3.js";import{s as M}from"./index.5438ffa5.js";import{g as $,d as x,c as B}from"./order.ef139ec7.js";import{_ as K}from"./UIInputSearch.afd2adfa.js";import"./index.b9661c2c.js";import"./debounce.89705bea.js";import"./isSymbol.efb1119a.js";import"./toNumber.eeb88cd2.js";import"./LeftOutlined.3faad919.js";import"./vendor.5c0531cb.js";import"./SearchOutlined.518e7dc4.js";import"./omit.8a509f15.js";import"./toString.a1b8407a.js";import"./identity.9f201e54.js";import"./_baseSlice.87986fb0.js";import"./CheckOutlined.3e9e09ac.js";import"./_baseProperty.91a23a79.js";import"./UIModal.33778fbe.js";import"./index.83b24380.js";const L=[{title:"全部",key:"all"},{title:"近三个月订单",key:"threeMonth"},{title:"近一个月订单",key:"oneMonth"},{title:"最近七天订单",key:"week"}],W={all:[],threeMonth:(()=>{const e=new Date,t=new Date;return t.setTime(t.getTime()-7776e6),[t,e]})(),oneMonth:(()=>{const e=new Date,t=new Date;return t.setTime(t.getTime()-2592e6),[t,e]})(),week:(()=>{const e=new Date,t=new Date;return t.setTime(t.getTime()-6048e5),[t,e]})()},Y=e=>JSON.parse(JSON.stringify({dateRange:e,startDate:W[e][0]&&g(W[e][0]),endDate:W[e][1]&&g(W[e][1])}));var F=n({name:"OrderTabPane",components:{UITabPane:a,UIButton:w,UIDropdown:j,Icon:i,UIPagination:N,UIEmpty:z,UISpin:D,UICountdown:A,PayRoutesPopover:R,PatentImage:E,UITooltip:q},props:{status:Number},setup({status:a}){const o=s(),n=r(),i=l(!1),g=l([]),f=l(o.query),h=l(o.query.dateRange?L.find((e=>e.key===o.query.dateRange)):L[1]),T=c({total:0,current:1,pageSize:10,pageSizeOptions:["10","30","50","100"],showSizeChange:(t,a)=>{window.scrollTo(0,0),n.push({path:"/user/order",query:e(e({},f.value),{size:a,no:1})})},change:t=>{window.scrollTo(0,0),n.push({path:"/user/order",query:e(e({},f.value),{no:t})})}}),b=o=>t(this,null,(function*(){if(i.value||(f.value.status||"999")!==(null==a?void 0:a.toString()))return;i.value=!0;const{data:t}=yield $(e(e(e({size:T.pageSize},Y(h.value.key)),o),{status:999===a?void 0:a})).finally((()=>i.value=!1));g.value=(null==t?void 0:t.list)||[],T.total=null==t?void 0:t.totalCount,T.current=null==t?void 0:t.no,T.pageSize=null==t?void 0:t.size}));u((e=>{f.value=e.query,b(e.query)})),p((()=>{b(f.value)}));return{loading:i,paginationOptions:T,orders:g,routeQuery:f,payOrder:(e,a)=>t(this,[e,a],(function*({payRoute:e,tradeType:t},a){const{orderNo:o,tradeNo:i}=a,s=`/order/pay/${"UMS_PAY"===e?"code":"WXPAY"===e?"wechat":"form"}?orderNo=${o}&tradeNo=${i}&type=PATENT&payRoute=${e}&tradeType=${t}`;"UMS_PAY"===e||"WXPAY"===e?yield n.push(s):(M({tradeNo:i,orderNo:o,type:"PATENT",getContainer:"orderTabPane"}),v(s))})),ORDER_STATUS:d,optionOrder:(e,a)=>t(this,null,(function*(){const o={delete:{label:"删除",requestApi:x},cancel:{label:"取消",requestApi:B}},{label:n,requestApi:i}=o[a];m.confirm({centered:!0,class:"warningModal",title:`确定要${n}该订单吗？`,okType:"danger",content:`若${n}订单将无法恢复`,onOk:()=>t(this,null,(function*(){const t=y.loading(`正在${n}订单，请稍候...`,0);yield i(e).finally((()=>t())),y.success(`${n}成功！`),yield b(f.value)}))})})),changeOrderStatus:e=>{g.value.find((t=>t.orderNo===e.orderNo)).status=d.CLOSED,g.value=[...g.value]},changeOrderTimeRange:e=>{h.value=L.find((t=>t.key===e)),n.push({path:"/user/order",query:Y(e)})},orderTimeRange:L,currentOrderTimeRange:h}}});const J=P("data-v-6c794144");f("data-v-6c794144");const Q={class:"listWrapper"},X={class:"listTitle"},G={class:"listTitle-item colTime"},H={class:"orderTimeRangeSelect"},V=S("li",{class:"listTitle-item colInfo"},"订单详情",-1),Z=S("li",{class:"listTitle-item colPrice"},"金额",-1),ee=S("li",{class:"listTitle-item colStatus"},"全部状态",-1),te=S("li",{class:"listTitle-item colOptions"},"操作",-1),ae={key:0,class:"emptyWrapper"},oe=C("去下单"),ne={class:"listContent"},ie={class:"listContent-item-top"},se={class:"time"},re={class:"listContent-item-content"},le={class:"listContent-item-content-image colTime"},ce={class:"listContent-item-content-info colInfo"},ue={class:"listContent-item-content-price colPrice"},pe=S("label",null,"原价：",-1),de=S("label",null,"VIP会员：",-1),me={class:"totalPrice"},ye=S("label",null,"应付款：",-1),ge=C("￥"),ve={class:"listContent-item-content-status colStatus"},fe={class:"listContent-item-content-options colOptions"},he={class:"listContent-item-content-options-optionsWrapper"},Te=C("取消订单"),be=C("删除订单"),ke={class:"paginationBar"};h();const Se=J(((e,t,a,o,n,i)=>{const s=T("Icon"),r=T("UIDropdown"),l=T("UIButton"),c=T("RouterLink"),u=T("UIEmpty"),p=T("PatentImage"),d=T("UICountdown"),m=T("PayRoutesPopover"),y=T("UITooltip"),g=T("UIPagination"),v=T("UISpin"),f=T("UITabPane");return b(),k(f,{id:"orderTabPane"},{default:J((()=>[S("div",Q,[S("ul",X,[S("li",G,[S(r,null,{overlay:J((()=>[S("ul",H,[(b(!0),k(O,null,I(e.orderTimeRange,(t=>(b(),k("li",{class:[e.currentOrderTimeRange.key===t.key&&"active"],key:t.key,onClick:a=>e.changeOrderTimeRange(t.key)},U(t.title),11,["onClick"])))),128))])])),default:J((()=>[S("span",null,[C(U(e.currentOrderTimeRange.title)+" ",1),S(s,{icon:"down"})])])),_:1})]),V,Z,ee,te]),0===e.orders.length?(b(),k("div",ae,[e.loading?_("",!0):(b(),k(u,{key:0,image:"order",description:"暂无相关订单"},{default:J((()=>[S(c,{to:"/patent"},{default:J((()=>[S(l,{"customer-class":"mainButton",type:"primary"},{default:J((()=>[oe])),_:1})])),_:1})])),_:1}))])):(b(),k(v,{key:1,spinning:e.loading},{default:J((()=>[S("ul",ne,[(b(!0),k(O,null,I(e.orders,(t=>(b(),k("li",{class:"listContent-item colTime",key:t.orderNo},[S("div",ie,[S("time",se,U(t.createTime),1),S("span",null,"订单号："+U(t.orderNo),1),S("span",null,"卖家："+U(t.sellerShopName),1)]),S("div",re,[S("div",le,[S(p,{cover:t.commodityCover},null,8,["cover"])]),S("div",ce,[S(c,{to:`/patent/${t.commodityNumber}`},{default:J((()=>[S("b",null,U(t.commodityName),1)])),_:2},1032,["to"]),S("p",null,"专利号："+U(t.commodityNumber),1)]),S("div",ue,[S("p",null,[pe,C("￥"+U(t.commodityPrice),1)]),(b(!0),k(O,null,I(t.discounts||[],(e=>(b(),k("p",{key:e.price},[de,C("-￥"+U(e.price),1)])))),128)),S("p",me,[ye,ge,S("b",null,U(t.totalAmount),1)])]),S("div",ve,U(e.ORDER_STATUS.label[t.status]),1),S("div",fe,[S("div",he,[t.status===e.ORDER_STATUS.CREATED?(b(),k(O,{key:0},[S(d,{class:"orderItemCountDown",onFinish:a=>e.changeOrderStatus(t),value:t.expireTime,format:"剩余m分s秒"},null,8,["onFinish","value"]),S("div",null,[S(m,{onChoose:a=>e.payOrder(a,t)},null,8,["onChoose"])]),S(l,{type:"link",size:"small","customer-class":"linkButton",onClick:a=>e.optionOrder(t,"cancel")},{default:J((()=>[Te])),_:2},1032,["onClick"])],64)):(b(),k(l,{key:1,type:"link",size:"small","customer-class":"linkButton",onClick:a=>e.optionOrder(t,"delete")},{default:J((()=>[be])),_:2},1032,["onClick"]))]),S(y,{title:t.remark},{default:J((()=>[t.remark?(b(),k(s,{key:0,icon:"remark"})):_("",!0)])),_:2},1032,["title"])])])])))),128))]),S("section",ke,[S(g,{size:"small",total:e.paginationOptions.total,pageSize:e.paginationOptions.pageSize,"onUpdate:pageSize":t[1]||(t[1]=t=>e.paginationOptions.pageSize=t),current:e.paginationOptions.current,"onUpdate:current":t[2]||(t[2]=t=>e.paginationOptions.current=t),"page-size-options":e.paginationOptions.pageSizeOptions,"show-total":e=>`共 ${e} 条`,onChange:e.paginationOptions.change,onShowSizeChange:e.paginationOptions.showSizeChange,"show-size-changer":"","show-quick-jumper":""},null,8,["total","pageSize","current","page-size-options","show-total","onChange","onShowSizeChange"])])])),_:1},8,["spinning"]))])])),_:1})}));F.render=Se,F.__scopeId="data-v-6c794144";const Oe=[{title:"全部订单",key:999},{title:"待付款",key:d.CREATED},{title:"已付款",key:d.PAYED},{title:"已关闭",key:d.CLOSED}];var Ie=n({name:"Order",components:{UITabs:o,OrderTabPane:F,UIInputSearch:K},setup(){const e=s(),t=r(),a=l(Number(e.query.status||999));return{changeTab:e=>{t.push({path:"/user/order",query:{status:999===e?void 0:e}})},ORDER_STATUS:d,activeKey:a,orderMap:Oe}}});const Ce=P("data-v-31be2c86");f("data-v-31be2c86");const Ue={class:"order"};h();const _e=Ce(((e,t,a,o,n,i)=>{const s=T("OrderTabPane"),r=T("UITabs");return b(),k("div",Ue,[S(r,{animated:!1,activeKey:e.activeKey,"onUpdate:activeKey":t[1]||(t[1]=t=>e.activeKey=t),onChange:e.changeTab},{default:Ce((()=>[(b(!0),k(O,null,I(e.orderMap,(e=>(b(),k(s,{key:e.key,status:e.key},{tab:Ce((()=>[S("b",null,U(e.title),1)])),_:2},1032,["status"])))),128))])),_:1},8,["activeKey","onChange"])])}));Ie.render=_e,Ie.__scopeId="data-v-31be2c86";export default Ie;
