var e=(e,t,o)=>new Promise(((r,n)=>{var a=e=>{try{i(o.next(e))}catch(e){n(e)}},l=e=>{try{i(o.throw(e))}catch(e){n(e)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,l);i((o=o.apply(e,t)).next())}));import{a3 as t,e as o,r,ah as n}from"./index.0b18afc5.js";import{M as a}from"./index.8c6984b6.js";import{O as l}from"./dict.a53fee1f.js";function i(){return new DOMException("The request is not allowed","NotAllowedError")}function d(t){return e(this,null,(function*(){try{yield function(t){return e(this,null,(function*(){if(!navigator.clipboard)throw i();return navigator.clipboard.writeText(t)}))}(t)}catch(o){try{yield function(t){return e(this,null,(function*(){const e=document.createElement("span");e.textContent=t,e.style.whiteSpace="pre",e.style.webkitUserSelect="auto",e.style.userSelect="all",document.body.appendChild(e);const o=window.getSelection(),r=window.document.createRange();null==o||o.removeAllRanges(),r.selectNode(e),null==o||o.addRange(r);let n=!1;try{n=window.document.execCommand("copy")}finally{null==o||o.removeAllRanges(),window.document.body.removeChild(e)}if(!n)throw i()}))}(t)}catch(e){throw e||o||i()}}}))}const s=e=>t({url:`/api/v1/order/trade/${e}/status`,method:"get"}),c=e=>e&&("string"==typeof e?e:e[0]),u=(e,t)=>{const o=document.createElement("a");o.target="_blank",o.style.display="none",o.href=e,o.rel="opener",t&&(o.download=`${t}.xlsx`),document.body.appendChild(o),o.click(),document.body.removeChild(o)},y=(e,t)=>u(window.URL.createObjectURL(e),t),m=(window.navigator.userAgent.toLowerCase().indexOf("micromessenger"),/webOS|phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone/i.test(window.navigator.userAgent)),p=e=>{d(e).then((()=>o.success("复制成功"))).catch((()=>o.error("复制失败")))},w=t=>e(this,null,(function*(){const{data:e}=yield s(t),o=e.tradeStatus;return o===l.WAIT_BUYER_PAY?(a.error({title:"您的订单尚未完成支付",content:"请检查您的支付信息"}),!1):o===l.TRADE_SUCCESS||o===l.TRADE_FINISHED||(o===l.TRADE_CLOSED?(a.error({title:"您的订单已关闭"}),!1):void 0)})),h=()=>{const t=r(0),i=r(!1),d=(r,c)=>e(this,[r,c],(function*({tradeNo:e,orderNo:r,commodityType:c},u){const{data:y}=yield s(e),m=y.tradeStatus;if(m===l.WAIT_BUYER_PAY){if(u>15)return void(i.value=!0);t.value=setTimeout((()=>d({tradeNo:e,orderNo:r,commodityType:c},u+1)),3e3)}else m===l.TRADE_SUCCESS||m===l.TRADE_FINISHED?(a.destroyAll(),yield n.push(`/order/pay/result?orderNo=${r}&tradeNo=${e}&status=1&type=${c}`)):m===l.TRADE_CLOSED&&(yield n.push(`/order/pay/result?orderNo=${r}&tradeNo=${e}&status=0&type=${c}`),a.destroyAll(),o.error("订单已关闭"))}));return{timer:t,pollGetPayResultDone:i,startPollGetPayResult:({tradeNo:e,orderNo:o,commodityType:r})=>{clearTimeout(t.value),t.value=setTimeout((()=>d({tradeNo:e,orderNo:o,commodityType:r},0)),5e3)},clearPollGetPayResult:()=>clearTimeout(t.value)}},f=e=>{const t=e||new Date,o=t.getMonth()+1;let r=o.toString();const n=t.getDate();let a=n.toString();return o>=1&&o<=9&&(r="0"+o),n>=0&&n<=9&&(a="0"+n),t.getFullYear()+"-"+r+"-"+a};export{y as a,m as b,p as c,f as d,c as g,w as i,u as o,h as u};
