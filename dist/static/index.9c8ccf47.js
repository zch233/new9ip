import{a4 as e,$ as t,G as n,az as r,d as a,r as o,aV as i,e as u,p as c,f as s,g as l,h as f,i as v,m as d,n as h}from"./index.b31cac7c.js";import{a as g}from"./toString.bb31df06.js";import{n as p,o as m,u as b}from"./identity.a18f49a7.js";import{s as y,a as j,o as w}from"./omit.d4167b66.js";import{b as O,S as k,c as C,d as I,v as P,e as S,f as V,i as A}from"./UIFormItem.18811c26.js";import{s as U}from"./UICountdown.e9d0b10c.js";import{d as q}from"./debounce.b0d617d0.js";import{s as F}from"./UIButton.a8b3563e.js";function x(e){return e!=e}function B(e,t){return!!(null==e?0:e.length)&&function(e,t,n){return t==t?function(e,t,n){for(var r=n-1,a=e.length;++r<a;)if(e[r]===t)return r;return-1}(e,t,n):O(e,x,n)}(e,t,0)>-1}function E(e,t,n){for(var r=-1,a=null==e?0:e.length;++r<a;)if(n(t,e[r]))return!0;return!1}var L=Math.min;function M(t){return function(t){return e(t)&&m(t)}(t)?t:[]}var D,R,_=y(j(D=function(e){var t=g(e,M);return t.length&&t[0]===e[0]?function(e,t,n){for(var r=n?E:B,a=e[0].length,o=e.length,i=o,u=Array(o),c=1/0,s=[];i--;){var l=e[i];i&&t&&(l=g(l,b(t))),c=L(l.length,c),u[i]=!n&&(t||a>=120&&l.length>=120)?new k(i&&l):void 0}l=e[0];var f=-1,v=u[0];e:for(;++f<a&&s.length<c;){var d=l[f],h=t?t(d):d;if(d=n||0!==d?d:0,!(v?C(v,h):r(s,h,n))){for(i=o;--i;){var p=u[i];if(!(p?C(p,h):r(e[i],h,n)))continue e}v&&v.push(h),s.push(d)}}return s}(t):[]},R,p),D+"");function $(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?Object(arguments[t]):{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){z(e,t,n[t])}))}return e}function z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function G(){return(G=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function H(e){var t=!1;return e&&e.length&&e.every((function(e){return!e.required||(t=!0,!1)})),t}function J(e){return null==e?[]:Array.isArray(e)?e:[e]}function K(e,t,n){for(var r=e,a=(t=(t=t.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"")).split("."),o=0,i=a.length;o<i-1&&(r||n);++o){var u=a[o];if(!(u in r)){if(n)throw new Error("please transfer a valid name path to validate!");break}r=r[u]}return{o:r,k:a[o],v:r?r[a[o]]:null,isValid:r&&a[o]in r}}function N(e,a,o){var i=I(e),u={};Object.keys(a).forEach((function(e){u[e]={autoLink:!1,required:H(a[e])}})),u=t(u);var c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;return t.length?e.filter((function(e){var n=J(e.trigger||"change");return _(n,t).length})):e},s=null,l=function(e,t,n,r){var a=P([e],t,n,$({validateMessages:S},r),!!r.validateFirst);return u[e].validateStatus="validating",a.catch((function(e){return e})).then((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];"validating"===u[e].validateStatus&&(u[e].validateStatus=t.length?"error":"success",u[e].help=t[0])})),a},f=function(t,n){var r=[],o=!0;t?r=Array.isArray(t)?t:[t]:(o=!1,r=Object.keys(a));var i=function(t){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,o=[],i={},u=function(u){var s=t[u],f=K(e,s,r);if(!f.isValid)return"continue";i[s]=f.v;var v=c(a[s],J(n&&n.trigger));v.length&&o.push(l(s,f.v,v,n||{}).then((function(){return{name:s,errors:[]}})).catch((function(e){return Promise.reject({name:s,errors:e})})))},f=0;f<t.length;f++)u(f);var v=V(o);s=v;var d=v.then((function(){return s===v?Promise.resolve(i):Promise.reject([])})).catch((function(e){var t=e.filter((function(e){return e&&e.errors.length}));return Promise.reject({values:i,errorFields:t,outOfDate:s!==v})}));return d.catch((function(e){return e})),d}(r,n||{},o);return i.catch((function(e){return e})),i},v=i,d=function(e){var t=[];Object.keys(a).forEach((function(n){var r=K(e,n,!1),a=K(v,n,!1);A(r.v,a.v)||t.push(n)})),f(t,{trigger:"change"}),v=I(e)},h=null==o?void 0:o.debounce;return r(e,h&&h.wait?q(d,h.wait,w(h,["wait"])):d,{immediate:o&&!!o.immediate,deep:!0}),r(a,(function(){o&&o.validateOnRuleChange&&f()}),{deep:!0}),{modelRef:e,rulesRef:a,initialModel:i,validateInfos:u,resetFields:function(t){G(e,$({},I(i),t)),n((function(){Object.keys(u).forEach((function(e){u[e]={autoLink:!1,required:H(a[e])}}))}))},validate:f,validateField:l,mergeValidateInfo:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t={autoLink:!1},n=[],r=Array.isArray(e)?e:[e],a=0;a<r.length;a++){var o=r[a];"error"===(null==o?void 0:o.validateStatus)&&(t.validateStatus="error",o.help&&n.push(o.help)),t.required=t.required||(null==o?void 0:o.required)}return t.help=n.join("\n"),t}}}var Q=a({name:"Captcha",components:{UIButton:F,UICountdown:U},props:{info:Object,member:Boolean},setup({info:e,member:t}){const n=o(!1),r=o(!1);return{captchaLoading:r,countdownVisible:n,getCaptcha:()=>{return a=this,o=null,c=function*(){r.value=!0,yield i[t?"getMemberCaptcha":"getCaptcha"](e).finally((()=>r.value=!1)),n.value=!n.value,u.success("获取验证码成功")},new Promise(((e,t)=>{var n=e=>{try{i(c.next(e))}catch(e){t(e)}},r=e=>{try{i(c.throw(e))}catch(e){t(e)}},i=t=>t.done?e(t.value):Promise.resolve(t.value).then(n,r);i((c=c.apply(a,o)).next())}));var a,o,c}}}});const T=d("data-v-f71d6872");c("data-v-f71d6872");const W=h("获取");s();const X=T(((e,t,n,r,a,o)=>{const i=l("UIButton"),u=l("UICountdown");return e.countdownVisible?(f(),v(u,{key:1,onFinish:t[1]||(t[1]=t=>e.countdownVisible=!e.countdownVisible),value:Date.now()+6e4,suffix:"s",format:"ss"},null,8,["value"])):(f(),v(i,{key:0,class:"captchaButton",loading:e.captchaLoading,block:"",onClick:e.getCaptcha},{default:T((()=>[W])),_:1},8,["loading","onClick"]))}));Q.render=X,Q.__scopeId="data-v-f71d6872";export{Q as s,N as u};
