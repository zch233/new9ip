var e=(e,s,t)=>new Promise(((a,n)=>{var o=e=>{try{r(t.next(e))}catch(e){n(e)}},l=e=>{try{r(t.throw(e))}catch(e){n(e)}},r=e=>e.done?a(e.value):Promise.resolve(e.value).then(o,l);r((t=t.apply(e,s)).next())}));import{d as s,s as t,r as a,af as n,w as o,e as l,p as r,f as i,g as c,h as u,i as d,m as p,j as v,n as m,v as f,a as b,u as P,c as y,t as h,F as I,l as g}from"./index.cfe7b146.js";import{M as C}from"./index.949368d9.js";import{p as j}from"./patent.47afb96e.js";import{s as k}from"./UIButton.413e7c4e.js";import{s as w}from"./UIModal.ad52060f.js";import{s as x}from"./collect.63de12ab.js";var B=s({name:"starIcon",components:{Icon:t},props:{complex:Boolean,patent:{type:Object,default:()=>({})}},setup(s,t){const r=a(!1),{patent:i}=n(s),c=a(!1);return o((()=>{c.value=i.value.collected})),{patent:i,collected:c,optionPatent:()=>e(this,null,(function*(){r.value||(r.value=!0,yield x(i.value.id).finally((()=>r.value=!1)),l.success(c.value?"已从我的收藏移除":"已加入我的收藏"),c.value=!c.value,t.emit("star",c.value))}))}}});const _=m("data-v-32bf95f6");r("data-v-32bf95f6");const M={key:0};i();const U=_(((e,s,t,a,n,o)=>{const l=c("Icon");return u(),d("div",{class:"starIcon",onClick:s[1]||(s[1]=(...s)=>e.optionPatent&&e.optionPatent(...s))},[e.complex?(u(),d("label",M,"收藏")):p("",!0),v(l,{icon:"star"+(e.collected?"_fill":"")},null,8,["icon"])])}));B.render=U,B.__scopeId="data-v-32bf95f6";var O=s({name:"PreorderButton",components:{UIButton:k,UIModal:w,Icon:t},props:{patent:{type:Object,default:()=>({})},big:Boolean,disabled:Boolean,size:String,className:String},setup(s){const t=f(),n=b(),o=P(),r=a(!1);return{userPoints:y((()=>t.getters.userPoints)),oneDayConsumePoints:y((()=>t.getters.oneDayConsumePoints)),preorderPatent:()=>e(this,null,(function*(){yield j({days:1,productId:s.patent.id}).finally((()=>r.value=!1)),l.success("预留成功"),yield n.push("/user/preorder"),t.commit("COMMIT_consumePointsByPreorder")})),visible:r,showModal:()=>{if(!t.state.user.account)return l.error("您尚未登录"),void n.push({path:"/auth/sign_in",query:{redirect:o.fullPath}});console.log(t.state.oneDayConsumePoints),t.state.oneDayConsumePoints>t.state.userPoints?C.confirm({title:"积分不足",content:"抱歉，您的剩余积分不足",okText:"立即充值",cancelText:"继续逛逛",onOk(){n.push("/vip")}}):r.value=!0}}}});const D=m("data-v-b0379df0");r("data-v-b0379df0");const z=g("预留"),T={class:"wrapper"},N=g("将消耗 "),S=g(" 个积分，是否继续？"),q=g("当前剩余："),F=g(" 积分");i();const A=D(((e,s,t,a,n,o)=>{const l=c("UIButton"),r=c("Icon"),i=c("UIModal");return u(),d(I,null,[v(l,{size:e.size,class:["preorderButton",[e.big&&"big",e.className]],disabled:e.disabled,"customer-class":"default",onClick:e.showModal},{default:D((()=>[z])),_:1},8,["size","class","disabled","onClick"]),v(i,{width:416,visible:e.visible,"onUpdate:visible":s[1]||(s[1]=s=>e.visible=s),maskClosable:!1,title:"预留专利",onOk:e.preorderPatent},{default:D((()=>[v("div",T,[v(r,{class:"warning",icon:"warning"}),v("div",null,[v("p",null,[v("b",null,"预留专利："+h(e.patent.name),1)]),v("p",null,[N,v("b",null,h(e.oneDayConsumePoints),1),S]),v("span",null,[q,v("b",null,h(e.userPoints),1),F])])])])),_:1},8,["visible","onOk"])],64)}));O.render=A,O.__scopeId="data-v-b0379df0";export{O as a,B as s};
