import{a2 as e,e as t,r as o,ah as r}from"./index.e0d03852.js";import{M as a}from"./index.1b896c71.js";import{O as n}from"./dict.a53fee1f.js";function s(){return new DOMException("The request is not allowed","NotAllowedError")}async function d(e){try{await async function(e){if(!navigator.clipboard)throw s();return navigator.clipboard.writeText(e)}(e)}catch(t){try{await async function(e){const t=document.createElement("span");t.textContent=e,t.style.whiteSpace="pre",t.style.webkitUserSelect="auto",t.style.userSelect="all",document.body.appendChild(t);const o=window.getSelection(),r=window.document.createRange();o?.removeAllRanges(),r.selectNode(t),o?.addRange(r);let a=!1;try{a=window.document.execCommand("copy")}finally{o?.removeAllRanges(),window.document.body.removeChild(t)}if(!a)throw s()}(e)}catch(e){throw e||t||s()}}}const l=t=>e({url:`/api/v1/order/trade/${t}/status`,method:"get"}),c=e=>e&&("string"==typeof e?e:e[0]),i=(e,t)=>{const o=document.createElement("a");o.target="_blank",o.style.display="none",o.href=e,o.rel="opener",t&&(o.download=`${t}.xlsx`),document.body.appendChild(o),o.click(),document.body.removeChild(o)},u=(e,t)=>i(window.URL.createObjectURL(e),t),y=e=>{d(e).then((()=>t.success("复制成功"))).catch((()=>t.error("复制失败")))},m=async e=>{const{data:t}=await l(e),o=t.tradeStatus;return o===n.WAIT_BUYER_PAY?(a.error({title:"您的订单尚未完成支付",content:"请检查您的支付信息"}),!1):o===n.TRADE_SUCCESS||o===n.TRADE_FINISHED||(o===n.TRADE_CLOSED?(a.error({title:"您的订单已关闭"}),!1):void 0)},p=()=>{const e=o(0),s=o(!1),d=async({tradeNo:o,orderNo:c,commodityType:i},u)=>{const{data:y}=await l(o),m=y.tradeStatus;if(m===n.WAIT_BUYER_PAY){if(u>15)return void(s.value=!0);e.value=setTimeout((()=>d({tradeNo:o,orderNo:c,commodityType:i},u+1)),3e3)}else m===n.TRADE_SUCCESS||m===n.TRADE_FINISHED?(a.destroyAll(),await r.push(`/order/pay/result?orderNo=${c}&tradeNo=${o}&status=1&type=${i}`)):m===n.TRADE_CLOSED&&(await r.push(`/order/pay/result?orderNo=${c}&tradeNo=${o}&status=0&type=${i}`),a.destroyAll(),t.error("订单已关闭"))};return{timer:e,pollGetPayResultDone:s,startPollGetPayResult:({tradeNo:t,orderNo:o,commodityType:r})=>{clearTimeout(e.value),e.value=setTimeout((()=>d({tradeNo:t,orderNo:o,commodityType:r},0)),5e3)},clearPollGetPayResult:()=>clearTimeout(e.value)}},w=e=>{const t=e||new Date,o=t.getMonth()+1;let r=o.toString();const a=t.getDate();let n=a.toString();return o>=1&&o<=9&&(r="0"+o),a>=0&&a<=9&&(n="0"+a),t.getFullYear()+"-"+r+"-"+n};export{u as a,w as b,y as c,c as g,m as i,i as o,p as u};
