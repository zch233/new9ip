import{d as e,_ as s,x as t,a,u as n,r as o,c as r,e as i,a7 as l,p as d,f as u,h as c,i as p,j as m,k as b,t as v,n as f,F as y,q as h,m as P}from"./index.2d412ebf.js";import{_ as I}from"./UIButton.9d1d39a3.js";import{_ as g}from"./UIModal.95de7cc6.js";import{p as C}from"./patent.32c286dd.js";var _=e({name:"PreorderButton",components:{UIButton:I,UIModal:g,Icon:s},props:{patent:{type:Object,default:()=>({})},big:Boolean,disabled:Boolean,size:String,buttonClass:String},setup(e){const s=t(),d=a(),u=n(),c=o(!1);return{userPoints:r((()=>s.getters.userPoints)),oneDayConsumePoints:r((()=>s.getters.oneDayConsumePoints)),preorderPatent:()=>{return t=this,a=null,n=function*(){yield C({days:1,productId:e.patent.id}).finally((()=>c.value=!1)),i.success("预留成功"),yield d.push("/user/preorder"),s.commit("COMMIT_consumePointsByPreorder")},new Promise(((e,s)=>{var o=e=>{try{i(n.next(e))}catch(t){s(t)}},r=e=>{try{i(n.throw(e))}catch(t){s(t)}},i=s=>s.done?e(s.value):Promise.resolve(s.value).then(o,r);i((n=n.apply(t,a)).next())}));var t,a,n},visible:c,showModal:()=>{if(!s.state.user.account)return i.error("您尚未登录"),void d.push({path:"/auth/sign_in",query:{redirect:u.fullPath}});s.state.oneDayConsumePoints>s.state.userPoints?l.confirm({title:"积分不足",content:"抱歉，您的剩余积分不足",okText:"立即充值",cancelText:"继续逛逛",onOk(){d.push("/vip")}}):c.value=!0}}}});const k=h("data-v-2df3d210");d("data-v-2df3d210");const w=P("预留"),x={class:"wrapper"},B=P("将消耗 "),M=P(" 个积分，是否继续？"),U=P("当前剩余："),j=P(" 积分");u();const D=k(((e,s,t,a,n,o)=>{const r=c("UIButton"),i=c("Icon"),l=c("UIModal");return p(),m(y,null,[b(r,{size:e.size,class:["preorderButton",[e.big&&"big",e.buttonClass]],disabled:e.disabled,"customer-class":"default",onClick:e.showModal},{default:k((()=>[w])),_:1},8,["size","class","disabled","onClick"]),b(l,{width:416,visible:e.visible,"onUpdate:visible":s[1]||(s[1]=s=>e.visible=s),maskClosable:!1,title:"预留专利",onOk:e.preorderPatent},{default:k((()=>[b("div",x,[b(i,{class:"warning",icon:"warning"}),b("div",null,[b("p",null,[b("b",null,"预留专利："+v(e.patent.name),1)]),f("        预留天数："),f("        <InputNumber autoFocus min={1} max={3} value={days} onChange={(day) => setDays(parseInt((day || 1).toString()))} /> 天"),b("p",null,[B,b("b",null,v(e.oneDayConsumePoints),1),M]),b("span",null,[U,b("b",null,v(e.userPoints),1),j])])])])),_:1},8,["visible","onOk"])],64)}));_.render=D,_.__scopeId="data-v-2df3d210";export{_};
