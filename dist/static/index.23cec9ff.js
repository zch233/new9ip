import{ab as e,a1 as t,I as r,aL as n,d as a,r as o,bi as i,e as u,p as c,f as s,h as l,i as f,j as v,q as d,m as h}from"./index.a7520e27.js";import{a as g}from"./toString.b0bb94f8.js";import{n as p,o as m,u as b}from"./identity.71cdfbef.js";import{s as y,a as j,o as w}from"./omit.27c63502.js";import{b as O,S as k,c as I,d as C,v as P,e as S,f as q,i as A}from"./UIFormItem.3a2ce36f.js";import{s as U}from"./UICountdown.c0c84c9a.js";import{d as V}from"./debounce.e5f8d5a5.js";import{s as F}from"./UIButton.27beda8b.js";function L(e){return e!=e}function x(e,t){return!!(null==e?0:e.length)&&function(e,t,r){return t==t?function(e,t,r){for(var n=r-1,a=e.length;++n<a;)if(e[n]===t)return n;return-1}(e,t,r):O(e,L,r)}(e,t,0)>-1}function B(e,t,r){for(var n=-1,a=null==e?0:e.length;++n<a;)if(r(t,e[n]))return!0;return!1}var E=Math.min;function M(t){return function(t){return e(t)&&m(t)}(t)?t:[]}var D,R,_=y(j(D=function(e){var t=g(e,M);return t.length&&t[0]===e[0]?function(e,t,r){for(var n=r?B:x,a=e[0].length,o=e.length,i=o,u=Array(o),c=1/0,s=[];i--;){var l=e[i];i&&t&&(l=g(l,b(t))),c=E(l.length,c),u[i]=!r&&(t||a>=120&&l.length>=120)?new k(i&&l):void 0}l=e[0];var f=-1,v=u[0];e:for(;++f<a&&s.length<c;){var d=l[f],h=t?t(d):d;if(d=r||0!==d?d:0,!(v?I(v,h):n(s,h,r))){for(i=o;--i;){var p=u[i];if(!(p?I(p,h):n(e[i],h,r)))continue e}v&&v.push(h),s.push(d)}}return s}(t):[]},R,p),D+"");function $(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?Object(arguments[t]):{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){z(e,t,r[t])}))}return e}function z(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function G(){return(G=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function H(e){var t=!1;return e&&e.length&&e.every((function(e){return!e.required||(t=!0,!1)})),t}function J(e){return null==e?[]:Array.isArray(e)?e:[e]}function K(e,t,r){for(var n=e,a=(t=(t=t.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"")).split("."),o=0,i=a.length;o<i-1&&(n||r);++o){var u=a[o];if(!(u in n)){if(r)throw new Error("please transfer a valid name path to validate!");break}n=n[u]}return{o:n,k:a[o],v:n?n[a[o]]:null,isValid:n&&a[o]in n}}function N(e,a,o){var i=C(e),u={};Object.keys(a).forEach((function(e){u[e]={autoLink:!1,required:H(a[e])}})),u=t(u);var c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;return t.length?e.filter((function(e){var r=J(e.trigger||"change");return _(r,t).length})):e},s=null,l=function(e,t,r,n){var a=P([e],t,r,$({validateMessages:S},n),!!n.validateFirst);return u[e].validateStatus="validating",a.catch((function(e){return e})).then((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];"validating"===u[e].validateStatus&&(u[e].validateStatus=t.length?"error":"success",u[e].help=t[0])})),a},f=function(t,r){var n=[],o=!0;t?n=Array.isArray(t)?t:[t]:(o=!1,n=Object.keys(a));var i=function(t){for(var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,o=[],i={},u=function(u){var s=t[u],f=K(e,s,n);if(!f.isValid)return"continue";i[s]=f.v;var v=c(a[s],J(r&&r.trigger));v.length&&o.push(l(s,f.v,v,r||{}).then((function(){return{name:s,errors:[]}})).catch((function(e){return Promise.reject({name:s,errors:e})})))},f=0;f<t.length;f++)u(f);var v=q(o);s=v;var d=v.then((function(){return s===v?Promise.resolve(i):Promise.reject([])})).catch((function(e){var t=e.filter((function(e){return e&&e.errors.length}));return Promise.reject({values:i,errorFields:t,outOfDate:s!==v})}));return d.catch((function(e){return e})),d}(n,r||{},o);return i.catch((function(e){return e})),i},v=i,d=function(e){var t=[];Object.keys(a).forEach((function(r){var n=K(e,r,!1),a=K(v,r,!1);A(n.v,a.v)||t.push(r)})),f(t,{trigger:"change"}),v=C(e)},h=null==o?void 0:o.debounce;return n(e,h&&h.wait?V(d,h.wait,w(h,["wait"])):d,{immediate:o&&!!o.immediate,deep:!0}),n(a,(function(){o&&o.validateOnRuleChange&&f()}),{deep:!0}),{modelRef:e,rulesRef:a,initialModel:i,validateInfos:u,resetFields:function(t){G(e,$({},C(i),t)),r((function(){Object.keys(u).forEach((function(e){u[e]={autoLink:!1,required:H(a[e])}}))}))},validate:f,validateField:l,mergeValidateInfo:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t={autoLink:!1},r=[],n=Array.isArray(e)?e:[e],a=0;a<n.length;a++){var o=n[a];"error"===(null==o?void 0:o.validateStatus)&&(t.validateStatus="error",o.help&&r.push(o.help)),t.required=t.required||(null==o?void 0:o.required)}return t.help=r.join("\n"),t}}}var Q=a({name:"Captcha",components:{UIButton:F,UICountdown:U},props:{info:Object,member:Boolean},setup({info:e,member:t}){const r=o(!1),n=o(!1);return{captchaLoading:n,countdownVisible:r,getCaptcha:()=>{return a=this,o=null,c=function*(){n.value=!0,yield i[t?"getMemberCaptcha":"getCaptcha"](e).finally((()=>n.value=!1)),r.value=!r.value,u.success("获取验证码成功")},new Promise(((e,t)=>{var r=e=>{try{i(c.next(e))}catch(e){t(e)}},n=e=>{try{i(c.throw(e))}catch(e){t(e)}},i=t=>t.done?e(t.value):Promise.resolve(t.value).then(r,n);i((c=c.apply(a,o)).next())}));var a,o,c}}}});const T=d("data-v-f71d6872");c("data-v-f71d6872");const W=h("获取");s();const X=T(((e,t,r,n,a,o)=>{const i=l("UIButton"),u=l("UICountdown");return e.countdownVisible?(f(),v(u,{key:1,onFinish:t[1]||(t[1]=t=>e.countdownVisible=!e.countdownVisible),value:Date.now()+6e4,suffix:"s",format:"ss"},null,8,["value"])):(f(),v(i,{key:0,class:"captchaButton",loading:e.captchaLoading,block:"",onClick:e.getCaptcha},{default:T((()=>[W])),_:1},8,["loading","onClick"]))}));Q.render=X,Q.__scopeId="data-v-f71d6872";export{Q as s,N as u};
