var e=Object.assign,t=(e,t,a)=>new Promise(((o,n)=>{var i=e=>{try{s(a.next(e))}catch(t){n(t)}},r=e=>{try{s(a.throw(e))}catch(t){n(t)}},s=e=>e.done?o(e.value):Promise.resolve(e.value).then(i,r);s((a=a.apply(e,t)).next())}));import{a,_ as o}from"./UITabPane.a7ce4ba9.js";import{ai as n,d as i,_ as r,u as s,q as l,r as d,ad as c,aM as p,y as u,bi as m,al as y,A as g,be as v,ak as f,D as T,F as h,G as S,H as P,J as b,b as k,K as I,L as O,O as C,Q as R,M as U,N as _}from"./index.ac0cd7df.js";import{_ as w}from"./UIButton.91505643.js";import{_ as j,a as N}from"./index.d32ee583.js";import{_ as z}from"./UIEmpty.c4b7e2d2.js";import{_ as E}from"./UIPagination.0a95436a.js";import{_ as D}from"./UISpin.5860f574.js";import{_ as A}from"./UICountdown.60f9b08c.js";import{_ as q}from"./index.23a145ad.js";import{_ as M}from"./index.c825a1f2.js";import{s as x}from"./index.73223c48.js";import{o as $}from"./orderConfirm.97a0d31e.js";import{_ as B}from"./UIInputSearch.b703e263.js";import"./index.fec7b509.js";import"./debounce.60279af9.js";import"./isSymbol.6f20698f.js";import"./toNumber.e3d0ade3.js";import"./LeftOutlined.934369ba.js";import"./vendor.5c0531cb.js";import"./SearchOutlined.d4e172dc.js";import"./omit.82f12eec.js";import"./toString.ebffae51.js";import"./identity.efe4c793.js";import"./_baseSlice.87986fb0.js";import"./CheckOutlined.57f9910a.js";import"./_baseProperty.a6cc78ed.js";import"./UIModal.d7a0acc4.js";import"./index.41572ccc.js";const L=[{title:"全部",key:"all"},{title:"近三个月订单",key:"threeMonth"},{title:"近一个月订单",key:"oneMonth"},{title:"最近七天订单",key:"week"}],K={all:[],threeMonth:(()=>{const e=new Date,t=new Date;return t.setTime(t.getTime()-7776e6),[t,e]})(),oneMonth:(()=>{const e=new Date,t=new Date;return t.setTime(t.getTime()-2592e6),[t,e]})(),week:(()=>{const e=new Date,t=new Date;return t.setTime(t.getTime()-6048e5),[t,e]})()},Y=e=>JSON.parse(JSON.stringify({dateRange:e,startDate:K[e][0]&&v(K[e][0]),endDate:K[e][1]&&v(K[e][1])}));var W=i({name:"OrderTabPane",components:{UITabPane:a,UIButton:w,UIDropdown:j,Icon:r,UIPagination:E,UIEmpty:z,UISpin:D,UICountdown:A,PayRoutesPopover:N,PatentImage:q,PrePatentCountdown:M},props:{status:Number},setup({status:a}){const o=s(),i=l(),r=d(!1),v=d([]),T=d(!1),h=d(null),S=d(o.query),P=d(o.query.dateRange?L.find((e=>e.key===o.query.dateRange)):L[1]),b=c({total:0,current:1,pageSize:10,pageSizeOptions:["10","30","50","100"],showSizeChange:(t,a)=>{window.scrollTo(0,0),i.push({path:"/user/preorder",query:e(e({},S.value),{size:a,no:1})})},change:t=>{window.scrollTo(0,0),i.push({path:"/user/preorder",query:e(e({},S.value),{no:t})})}}),k=o=>t(this,null,(function*(){if(r.value||(S.value.status||"999")!==(null==a?void 0:a.toString()))return;r.value=!0;const{data:t}=yield(i=e(e(e({size:b.pageSize},Y(P.value.key)),o),{status:999===a?void 0:a}),n({url:"/api/v1/reserve",method:"get",params:i})).finally((()=>r.value=!1));var i;v.value=(null==t?void 0:t.list)||[],b.total=null==t?void 0:t.totalCount,b.current=null==t?void 0:t.no,b.pageSize=null==t?void 0:t.size}));p((e=>{S.value=e.query,k(e.query)})),u((()=>{k(S.value)}));return{loading:r,submitLoading:T,paginationOptions:b,payRoutesPopoverRef:h,preorders:v,routeQuery:S,payOrder:(e,a)=>t(this,[e,a],(function*({payRoute:e,tradeType:t},a){T.value=!1,h.value.visible=!1;const{data:o}=yield $({commodityId:a.productId,commodityType:"PATENT",payRoute:e,tradeType:t}).finally((()=>T.value=!1)),{orderNo:n,tradeNo:r}=o,s=`/order/pay/${"UMS_PAY"===e?"code":"WXPAY"===e?"wechat":"form"}?orderNo=${n}&tradeNo=${r}&type=PATENT&payRoute=${e}&tradeType=${t}`;"UMS_PAY"===e||"WXPAY"===e?yield i.push(s):(x({tradeNo:r,orderNo:n,type:"PATENT",getContainer:"preorderTabPane"}),f(s))})),PREORDER_STATUS:m,optionOrder:e=>t(this,null,(function*(){y.confirm({centered:!0,class:"warningModal",title:"确定要取消该预留吗？",okType:"danger",content:"若取消预留今日将不能再次预留且积分不再返还",onOk:()=>t(this,null,(function*(){const t=g.loading("正在取消预留，请稍候...",0);var a;yield(a=e.id,n({url:`/api/v1/reserve/cancel/${a}`,method:"put"})).finally((()=>t())),g.success("取消成功！"),yield k(S.value)}))})})),changeOrderStatus:e=>{v.value.find((t=>t.orderNo===e.orderNo)).status=m.CANCEL,v.value=[...v.value]},changeOrderTimeRange:e=>{P.value=L.find((t=>t.key===e)),i.push({path:"/user/preorder",query:Y(e)})},orderTimeRange:L,currentOrderTimeRange:P}}});const J=_("data-v-6a3d362c");T("data-v-6a3d362c");const Q={class:"listWrapper"},X={class:"listTitle"},F={class:"listTitle-item colTime"},G={class:"orderTimeRangeSelect"},H=k("li",{class:"listTitle-item colInfo"},"订单详情",-1),V=k("li",{class:"listTitle-item colPrice"},"金额",-1),Z=k("li",{class:"listTitle-item colStatus"},"全部状态",-1),ee=k("li",{class:"listTitle-item colOptions"},"操作",-1),te={key:0,class:"emptyWrapper"},ae={class:"listContent"},oe={class:"listContent-item-top"},ne={class:"time"},ie={key:0},re={class:"listContent-item-content"},se={class:"listContent-item-content-image colTime"},le={class:"listContent-item-content-info colInfo"},de={class:"listContent-item-content-price colPrice"},ce=k("label",null,"价格：",-1),pe=k("label",null,"VIP会员：",-1),ue={class:"listContent-item-content-status colStatus"},me={class:"listContent-item-content-options colOptions"},ye=C("去下单"),ge=C("取消预留"),ve={class:"paginationBar"};h();const fe=J(((e,t,a,o,n,i)=>{const r=S("Icon"),s=S("UIDropdown"),l=S("UIEmpty"),d=S("PatentImage"),c=S("RouterLink"),p=S("PrePatentCountdown");S("PayRoutesPopover");const u=S("UIButton"),m=S("UIPagination"),y=S("UISpin"),g=S("UITabPane");return P(),b(g,{id:"preorderTabPane"},{default:J((()=>[k("div",Q,[k("ul",X,[k("li",F,[k(s,null,{overlay:J((()=>[k("ul",G,[(P(!0),b(I,null,O(e.orderTimeRange,(t=>(P(),b("li",{class:[e.currentOrderTimeRange.key===t.key&&"active"],key:t.key,onClick:a=>e.changeOrderTimeRange(t.key)},R(t.title),11,["onClick"])))),128))])])),default:J((()=>[k("span",null,[C(R(e.currentOrderTimeRange.title)+" ",1),k(r,{icon:"down"})])])),_:1})]),H,V,Z,ee]),0===e.preorders.length?(P(),b("div",te,[e.loading?U("",!0):(P(),b(l,{key:0,image:"order",description:"暂无相关预留"}))])):(P(),b(y,{key:1,spinning:e.loading},{default:J((()=>[k("ul",ae,[(P(!0),b(I,null,O(e.preorders,(t=>(P(),b("li",{class:"listContent-item colTime",key:t.productId},[k("div",oe,[k("time",ne,R(t.createTime),1),t.orderNo?(P(),b("span",ie,"订单号："+R(t.orderNo),1)):U("",!0),k("span",null,"卖家："+R(t.sellerShopName),1)]),k("div",re,[k("div",se,[k(d,{cover:t.productCover},null,8,["cover"])]),k("div",le,[k(c,{to:`/patent/${t.productNumber}`},{default:J((()=>[k("b",null,R(t.productName),1)])),_:2},1032,["to"]),k("p",null,"专利号："+R(t.productNumber),1)]),k("div",de,[k("p",null,[ce,C("￥"+R(t.productPrice),1)]),k("p",null,[pe,C("￥"+R(t.vipPrice),1)])]),k("div",ue,R(e.PREORDER_STATUS.label[t.status]),1),k("div",me,[t.status===e.PREORDER_STATUS.CREATED?(P(),b(I,{key:0},[k(p,{patent:t},null,8,["patent"]),U("",!0),k("div",null,[k(c,{to:{path:"/order/confirm",query:{commodityId:t.productId}}},{default:J((()=>[k(u,{type:"primary","customer-class":"mainButton"},{default:J((()=>[ye])),_:1})])),_:2},1032,["to"])]),k(u,{type:"link",size:"small","customer-class":"linkButton",onClick:a=>e.optionOrder(t)},{default:J((()=>[ge])),_:2},1032,["onClick"])],64)):U("",!0)])])])))),128))]),k("section",ve,[k(m,{size:"small",total:e.paginationOptions.total,pageSize:e.paginationOptions.pageSize,"onUpdate:pageSize":t[1]||(t[1]=t=>e.paginationOptions.pageSize=t),current:e.paginationOptions.current,"onUpdate:current":t[2]||(t[2]=t=>e.paginationOptions.current=t),"page-size-options":e.paginationOptions.pageSizeOptions,"show-total":e=>`共 ${e} 条`,onChange:e.paginationOptions.change,onShowSizeChange:e.paginationOptions.showSizeChange,"show-size-changer":"","show-quick-jumper":""},null,8,["total","pageSize","current","page-size-options","show-total","onChange","onShowSizeChange"])])])),_:1},8,["spinning"]))])])),_:1})}));W.render=fe,W.__scopeId="data-v-6a3d362c";const Te=[{title:"全部",key:999},{title:"预留中",key:m.CREATED},{title:"已下单",key:m.ORDER},{title:"已付款",key:m.PAYED},{title:"已取消",key:m.CANCEL}];var he=i({name:"Order",components:{UITabs:o,OrderTabPane:W,UIInputSearch:B},setup(){const e=s(),t=l(),a=d(e.query.status);return{PREORDER_STATUS:m,activeKey:a,orderMap:Te,changeTab:e=>{t.push({path:"/user/preorder",query:{status:999===e?void 0:e}})}}}});const Se=_("data-v-10afe7d8");T("data-v-10afe7d8");const Pe={class:"order"};h();const be=Se(((e,t,a,o,n,i)=>{const r=S("OrderTabPane"),s=S("UITabs");return P(),b("div",Pe,[k(s,{animated:!1,activeKey:e.activeKey,onChange:e.changeTab},{default:Se((()=>[(P(!0),b(I,null,O(e.orderMap,(e=>(P(),b(r,{key:e.key,status:e.key},{tab:Se((()=>[k("b",null,R(e.title),1)])),_:2},1032,["status"])))),128))])),_:1},8,["activeKey","onChange"])])}));he.render=be,he.__scopeId="data-v-10afe7d8";export default he;
