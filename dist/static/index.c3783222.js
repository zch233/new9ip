var e=Object.assign,t=(e,t,a)=>new Promise(((o,n)=>{var i=e=>{try{s(a.next(e))}catch(t){n(t)}},r=e=>{try{s(a.throw(e))}catch(t){n(t)}},s=e=>e.done?o(e.value):Promise.resolve(e.value).then(i,r);s((a=a.apply(e,t)).next())}));import{a4 as a,d as o,_ as n,u as i,a as r,r as s,$ as l,aE as d,o as p,bd as c,a7 as u,e as m,b9 as y,a6 as g,p as v,f,h as b,i as T,j as h,k as S,F as P,l as k,t as I,m as O,n as C,q as R}from"./index.a82679ed.js";import{a as U,_}from"./UITabPane.456f9f83.js";import{_ as j}from"./UIButton.21dc6c50.js";import{_ as w,a as E}from"./index.3ea473d0.js";import{_ as N}from"./UIEmpty.6ebc1254.js";import{_ as z}from"./UIPagination.28ff65b3.js";import{_ as D}from"./UISpin.b8c5ae06.js";import{_ as A}from"./UICountdown.6766090b.js";import{_ as q}from"./index.5a475017.js";import{_ as x}from"./index.b0ac73d4.js";import{s as M}from"./index.4cb207f4.js";import{o as $}from"./orderConfirm.49477ecb.js";import{_ as B}from"./UIInputSearch.634db2ab.js";import"./vendor.5c0531cb.js";import"./index.ab4baf4a.js";import"./debounce.985e3bb0.js";import"./isSymbol.cd9fc807.js";import"./toNumber.5cb10dbc.js";import"./LeftOutlined.b0181f39.js";import"./SearchOutlined.a27b337d.js";import"./omit.32db2ed1.js";import"./toString.c0daa73c.js";import"./identity.9a6781ef.js";import"./_baseSlice.87986fb0.js";import"./CheckOutlined.869e71b6.js";import"./_baseProperty.a1d60b79.js";import"./UIModal.c37b05d3.js";import"./index.65d023e1.js";const L=[{title:"全部",key:"all"},{title:"近三个月预留",key:"threeMonth"},{title:"近一个月预留",key:"oneMonth"},{title:"最近七天预留",key:"week"}],Y={all:[],threeMonth:(()=>{const e=new Date,t=new Date;return t.setTime(t.getTime()-7776e6),[t,e]})(),oneMonth:(()=>{const e=new Date,t=new Date;return t.setTime(t.getTime()-2592e6),[t,e]})(),week:(()=>{const e=new Date,t=new Date;return t.setTime(t.getTime()-6048e5),[t,e]})()},K=e=>JSON.parse(JSON.stringify({dateRange:e,startDate:Y[e][0]&&y(Y[e][0]),endDate:Y[e][1]&&y(Y[e][1])}));var W=o({name:"OrderTabPane",components:{UITabPane:U,UIButton:j,UIDropdown:w,Icon:n,UIPagination:z,UIEmpty:N,UISpin:D,UICountdown:A,PayRoutesPopover:E,PatentImage:q,PrePatentCountdown:x},props:{status:Number},setup({status:o}){const n=i(),y=r(),v=s(!1),f=s([]),b=s(!1),T=s(null),h=s(n.query),S=s(n.query.dateRange?L.find((e=>e.key===n.query.dateRange)):L[1]),P=l({total:0,current:1,pageSize:10,pageSizeOptions:["10","30","50","100"],showSizeChange:(t,a)=>{window.scrollTo(0,0),y.push({path:"/user/preorder",query:e(e({},h.value),{size:a,no:1})})},change:t=>{window.scrollTo(0,0),y.push({path:"/user/preorder",query:e(e({},h.value),{no:t})})}}),k=n=>t(this,null,(function*(){if(v.value||(h.value.status||"999")!==(null==o?void 0:o.toString()))return;v.value=!0;const{data:t}=yield(i=e(e(e({size:P.pageSize},K(S.value.key)),n),{status:999===o?void 0:o}),a({url:"/api/v1/reserve",method:"get",params:i})).finally((()=>v.value=!1));var i;f.value=(null==t?void 0:t.list)||[],P.total=null==t?void 0:t.totalCount,P.current=null==t?void 0:t.no,P.pageSize=null==t?void 0:t.size}));d((e=>{h.value=e.query,k(e.query)})),p((()=>{k(h.value)}));return{loading:v,submitLoading:b,paginationOptions:P,payRoutesPopoverRef:T,preorders:f,routeQuery:h,payOrder:(e,a)=>t(this,[e,a],(function*({payRoute:e,tradeType:t},a){b.value=!1,T.value.visible=!1;const{data:o}=yield $({commodityId:a.productId,commodityType:"PATENT",payRoute:e,tradeType:t}).finally((()=>b.value=!1)),{orderNo:n,tradeNo:i}=o,r=`/order/pay/${"UMS_PAY"===e?"code":"WXPAY"===e?"wechat":"form"}?orderNo=${n}&tradeNo=${i}&type=PATENT&payRoute=${e}&tradeType=${t}`;"UMS_PAY"===e||"WXPAY"===e?yield y.push(r):(M({tradeNo:i,orderNo:n,type:"PATENT",getContainer:"preorderTabPane"}),g(r))})),PREORDER_STATUS:c,optionOrder:e=>t(this,null,(function*(){u.confirm({centered:!0,class:"warningModal",title:"确定要取消该预留吗？",okType:"danger",content:"若取消预留今日将不能再次预留且积分不再返还",onOk:()=>t(this,null,(function*(){const t=m.loading("正在取消预留，请稍候...",0);var o;yield(o=e.id,a({url:`/api/v1/reserve/cancel/${o}`,method:"put"})).finally((()=>t())),m.success("取消成功！"),yield k(h.value)}))})})),changeOrderStatus:e=>{f.value.find((t=>t.orderNo===e.orderNo)).status=c.CANCEL,f.value=[...f.value]},changeOrderTimeRange:e=>{S.value=L.find((t=>t.key===e)),y.push({path:"/user/preorder",query:K(e)})},orderTimeRange:L,currentOrderTimeRange:S}}});const J=R("data-v-2dbc2169");v("data-v-2dbc2169");const X={class:"listWrapper"},F={class:"listTitle"},Q={class:"listTitle-item colTime"},V={class:"orderTimeRangeSelect"},G=S("li",{class:"listTitle-item colInfo"},"预购订单详情",-1),H=S("li",{class:"listTitle-item colPrice"},"金额",-1),Z=S("li",{class:"listTitle-item colStatus"},"全部状态",-1),ee=S("li",{class:"listTitle-item colOptions"},"操作",-1),te={key:0,class:"emptyWrapper"},ae={class:"listContent"},oe={class:"listContent-item-top"},ne={class:"time"},ie={key:0},re={class:"listContent-item-content"},se={class:"listContent-item-content-image colTime"},le={class:"listContent-item-content-info colInfo"},de={class:"listContent-item-content-price colPrice"},pe=S("label",null,"价格：",-1),ce=S("label",null,"VIP会员：",-1),ue={class:"listContent-item-content-status colStatus"},me={class:"listContent-item-content-options colOptions"},ye=O("去下单"),ge=O("取消预留"),ve={class:"paginationBar"};f();const fe=J(((e,t,a,o,n,i)=>{const r=b("Icon"),s=b("UIDropdown"),l=b("UIEmpty"),d=b("PatentImage"),p=b("RouterLink"),c=b("PrePatentCountdown");b("PayRoutesPopover");const u=b("UIButton"),m=b("UIPagination"),y=b("UISpin"),g=b("UITabPane");return T(),h(g,{id:"preorderTabPane"},{default:J((()=>[S("div",X,[S("ul",F,[S("li",Q,[S(s,null,{overlay:J((()=>[S("ul",V,[(T(!0),h(P,null,k(e.orderTimeRange,(t=>(T(),h("li",{class:[e.currentOrderTimeRange.key===t.key&&"active"],key:t.key,onClick:a=>e.changeOrderTimeRange(t.key)},I(t.title),11,["onClick"])))),128))])])),default:J((()=>[S("span",null,[O(I(e.currentOrderTimeRange.title)+" ",1),S(r,{icon:"down"})])])),_:1})]),G,H,Z,ee]),0===e.preorders.length?(T(),h("div",te,[e.loading?C("v-if",!0):(T(),h(l,{key:0,image:"order",description:"暂无相关预留"}))])):(T(),h(y,{key:1,spinning:e.loading},{default:J((()=>[S("ul",ae,[(T(!0),h(P,null,k(e.preorders,(t=>(T(),h("li",{class:"listContent-item colTime",key:t.productId},[S("div",oe,[S("time",ne,I(t.createTime),1),t.orderNo?(T(),h("span",ie,"预购订单号："+I(t.orderNo),1)):C("v-if",!0),S("span",null,"卖家："+I(t.sellerShopName),1)]),S("div",re,[S("div",se,[S(d,{cover:t.productCover},null,8,["cover"])]),S("div",le,[S(p,{to:`/patent/${t.productNumber}`},{default:J((()=>[S("b",null,I(t.productName),1)])),_:2},1032,["to"]),S("p",null,"专利号："+I(t.productNumber),1)]),S("div",de,[S("p",null,[pe,O("￥"+I(t.productPrice),1)]),S("p",null,[ce,O("￥"+I(t.vipPrice),1)])]),S("div",ue,I(e.PREORDER_STATUS.label[t.status]),1),S("div",me,[t.status===e.PREORDER_STATUS.CREATED?(T(),h(P,{key:0},[S(c,{patent:t},null,8,["patent"]),C("v-if",!0),S("div",null,[S(p,{to:{path:"/order/confirm",query:{commodityId:t.productId}}},{default:J((()=>[S(u,{type:"primary","customer-class":"mainButton"},{default:J((()=>[ye])),_:1})])),_:2},1032,["to"])]),S(u,{type:"link",size:"small","customer-class":"linkButton",onClick:a=>e.optionOrder(t)},{default:J((()=>[ge])),_:2},1032,["onClick"])],64)):C("v-if",!0)])])])))),128))]),S("section",ve,[S(m,{size:"small",total:e.paginationOptions.total,pageSize:e.paginationOptions.pageSize,"onUpdate:pageSize":t[1]||(t[1]=t=>e.paginationOptions.pageSize=t),current:e.paginationOptions.current,"onUpdate:current":t[2]||(t[2]=t=>e.paginationOptions.current=t),"page-size-options":e.paginationOptions.pageSizeOptions,"show-total":e=>`共 ${e} 条`,onChange:e.paginationOptions.change,onShowSizeChange:e.paginationOptions.showSizeChange,"show-size-changer":"","show-quick-jumper":""},null,8,["total","pageSize","current","page-size-options","show-total","onChange","onShowSizeChange"])])])),_:1},8,["spinning"]))])])),_:1})}));W.render=fe,W.__scopeId="data-v-2dbc2169";const be=[{title:"全部",key:999},{title:"预留中",key:c.CREATED},{title:"已下单",key:c.ORDER},{title:"已付款",key:c.PAYED},{title:"已取消",key:c.CANCEL}];var Te=o({name:"Order",components:{UITabs:_,OrderTabPane:W,UIInputSearch:B},setup(){const e=i(),t=r(),a=s(e.query.status);return{PREORDER_STATUS:c,activeKey:a,orderMap:be,changeTab:e=>{t.push({path:"/user/preorder",query:{status:999===e?void 0:e}})}}}});const he=R("data-v-1f19bfe8");v("data-v-1f19bfe8");const Se={class:"order"};f();const Pe=he(((e,t,a,o,n,i)=>{const r=b("OrderTabPane"),s=b("UITabs");return T(),h("div",Se,[S(s,{animated:!1,activeKey:e.activeKey,onChange:e.changeTab},{default:he((()=>[(T(!0),h(P,null,k(e.orderMap,(e=>(T(),h(r,{key:e.key,status:e.key},{tab:he((()=>[S("b",null,I(e.title),1)])),_:2},1032,["status"])))),128))])),_:1},8,["activeKey","onChange"])])}));Te.render=Pe,Te.__scopeId="data-v-1f19bfe8";export default Te;
